{% extends "base.html" %}
{% block title %}{{ recipe.name }} - Cocina 360{% endblock %}

{% block extra_head %}
<style>
  /* —— Estilos encapsulados para esta página —— */
  .detail { max-width: 800px; margin: 0 auto; line-height: 1.6; }
  .detail a { color: #0077cc; text-decoration: none; }
  .detail a:hover { text-decoration: underline; }

  .detail h1 {
    font-size: 2.2rem;
    margin: 0 0 10px;
    color: #2c3e50;
    border-bottom: 2px solid #0077cc;
    padding-bottom: 8px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .detail h2 {
    margin-top: 30px; margin-bottom: 15px;
    color: #34495e; border-bottom: 1px solid #ddd; padding-bottom: 6px;
  }
  .detail p { font-size: 1rem; margin-bottom: 10px; color: #555; }

  .detail ul, .detail ol { margin-left: 20px; margin-bottom: 20px; }
  .detail li { margin-bottom: 12px; font-size: 1.05rem; display: flex; align-items: center; }

  .detail form { display: flex; align-items: center; width: 100%; }
  .detail input[type="checkbox"] {
    width: 20px; height: 20px; margin-right: 12px; cursor: pointer; accent-color: #0077cc;
  }
  .detail label.checkbox-label { cursor: pointer; flex: 1; user-select: none; }
  .detail label.completed { text-decoration: line-through; color: #999; font-style: italic; }

  /* Favoritos */
  .detail form.favorite-form { margin-left: 15px; }
  .detail button.favorite-btn {
    background: none; border: none; cursor: pointer; font-size: 2rem;
    color: gray; transition: color 0.3s ease; padding: 0; margin-left: 15px;
  }
  .detail button.favorite-btn.favorited { color: red; }
  .detail button.favorite-btn:hover { color: #cc0000; }

  /* Botón volver */
  .detail .back-link {
    display: inline-block; margin-top: 30px; padding: 10px 18px;
    background-color: #0077cc; color: white; border-radius: 4px; font-weight: 600;
    transition: background-color 0.3s ease; text-decoration: none;
  }
  .detail .back-link:hover { background-color: #005fa3; }

  @media (max-width: 600px) {
    .detail h1 { font-size: 1.8rem; flex-direction: column; align-items: flex-start; }
    .detail button.favorite-btn { margin-left: 0; margin-top: 10px; }
    .detail li { font-size: 1rem; }
  }
</style>
{% endblock %}

{% block content %}
<div class="detail">
  <h1>
    {{ recipe.name }}
    {% if user.is_authenticated %}
      <form action="{% url 'toggle_favorite' pk=recipe.pk %}" method="post" class="favorite-form" title="Toggle Favorite">
        {% csrf_token %}
        {% if recipe.pk in favorite_recipe_ids %}
          <button type="submit" class="favorite-btn favorited" aria-label="Remove from favorites">♥</button>
        {% else %}
          <button type="submit" class="favorite-btn" aria-label="Add to favorites">♡</button>
        {% endif %}
      </form>
    {% endif %}
  </h1>

  <p><strong>Preparation Time:</strong> {{ recipe.preparation_time }} minutes</p>
  <p><strong>Portions:</strong>
    {% if recipe.min_portion %}{{ recipe.min_portion }}{% endif %}
    {% if recipe.max_portion %} - {{ recipe.max_portion }}{% endif %}
  </p>

  <h2>Ingredients</h2>
  <ul>
    {% for item in ingredients_with_status %}
      <li>
        <form action="{% url 'toggle_ingredient_completion' recipe_pk=recipe.pk ingredient_pk=item.ingredient.pk %}" method="post">
          {% csrf_token %}
          <input type="checkbox" id="ingredient-{{ item.ingredient.pk }}" name="completed"
                 onchange="this.form.submit()" {% if item.completed %}checked{% endif %}>
          <label for="ingredient-{{ item.ingredient.pk }}" class="checkbox-label {% if item.completed %}completed{% endif %}">
            {{ item.ingredient.name }}
          </label>
        </form>
      </li>
    {% endfor %}
  </ul>

  <h2>Steps</h2>
  <ol>
    {% for item in steps_with_status %}
      <li>
        <form action="{% url 'toggle_step_completion' recipe_pk=recipe.pk step_pk=item.step.pk %}" method="post">
          {% csrf_token %}
          <input type="checkbox" id="step-{{ item.step.pk }}" name="completed"
                 onchange="this.form.submit()" {% if item.completed %}checked{% endif %}>
          <label for="step-{{ item.step.pk }}" class="checkbox-label {% if item.completed %}completed{% endif %}">
            {{ item.step.description }}
          </label>
        </form>
      </li>
    {% endfor %}
  </ol>

  <a href="{% url 'recipe_list' %}" class="back-link">← Back to Recipes</a>

  {% if user.is_authenticated and user == recipe.creator %}
    <form action="{% url 'recipe_delete' pk=recipe.pk %}" method="get" style="margin-top: 30px;">
      <button type="submit" style="
          background-color: #cc3300; color: white; border: none; padding: 12px 24px;
          border-radius: 6px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease;"
        onmouseover="this.style.backgroundColor='#992200'"
        onmouseout="this.style.backgroundColor='#cc3300'">
        Delete Recipe
      </button>
    </form>
  {% endif %}
</div>
{% endblock %}
